<!DOCTYPE html>
<html>
<head>
  <title>Result Screen Preview - リザルト画面プレビュー</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/jspsych@7"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1"></script>
  <link href="https://unpkg.com/jspsych@7/css/jspsych.css" rel="stylesheet" type="text/css" />
  <link href="../styles.css" rel="stylesheet" type="text/css" />
  <style>
    body {
      font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <div id="jspsych-target"></div>
  
  <script>
    // Initialize jsPsych v7 instance
    const jsPsych = initJsPsych({
      display_element: 'jspsych-target',
      on_finish: function() {
        alert('プレビュー完了！実際の実験では、この後データが送信されます。');
      }
    });

    // Mock data to simulate experiment results
    const mockSearchData = {
      count: () => 120, // Total trials
      filter: (criteria) => ({
        count: () => criteria.correct ? 102 : 120, // 85% accuracy
        select: (field) => ({
          values: field === 'rt' ? 
            Array.from({length: 120}, () => Math.random() * 2000 + 1500) : // 1.5-3.5 second range
            Array.from({length: 120}, () => Math.random() > 0.15) // 85% correct
        })
      }),
      select: (field) => ({
        values: field === 'rt' ? 
          Array.from({length: 120}, () => Math.random() * 2000 + 1500) : // Random response times
          (field === 'memory_correct' ? 
            Array.from({length: 60}, () => Math.random() > 0.25) : // 75% memory accuracy
            [])
      })
    };

    // Enhanced result screen preview with sample data
    const resultScreenPreview = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        // Simulate calculation with mock data
        const searchAccuracy = 85; // Mock 85% accuracy
        const avgSearchTimeSeconds = 2.34; // Mock average time
        const memoryAccuracy = 75; // Mock 75% memory accuracy
        
        const memoryAccuracyText = `<p style="font-size: 18px; margin: 15px 0;">パネル記憶の正答率：${memoryAccuracy}％</p>`;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">実験は終了です。お疲れ様でした！</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">実験結果</h2>
              <p style="font-size: 18px; margin: 15px 0;">図形探しの正答率：${searchAccuracy}％</p>
              <p style="font-size: 18px; margin: 15px 0;">図形探しのスピード：平均${avgSearchTimeSeconds}秒</p>
              ${memoryAccuracyText}
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">実験の終了プロセス</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>下の「終了する」ボタンを押すと実験データの送信が行われます。</li>
                <li>データの送信中は、画面に英語が表示されます。送信が終わると真っ白な画面になります。</li>
                <li>真っ白な画面になったら実験終了です。画面を閉じて構いません。</li>
                <li>ご協力ありがとうございました！</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">終了する</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #fff3cd; border-radius: 8px;">
              <p style="font-size: 14px; color: #856404; margin: 0;">
                <strong>📝 プレビューノート:</strong> これは結果画面のプレビューです。実際の実験では、参加者の実際のデータが表示されます。
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Alternative version with different sample data
    const alternativeResultScreen = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        // Different sample data for comparison
        const searchAccuracy = 92; // Higher accuracy sample
        const avgSearchTimeSeconds = 1.87; // Faster time sample
        const memoryAccuracy = 83; // Different memory accuracy
        
        const memoryAccuracyText = `<p style="font-size: 18px; margin: 15px 0;">パネル記憶の正答率：${memoryAccuracy}％</p>`;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">実験は終了です。お疲れ様でした！</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">実験結果</h2>
              <p style="font-size: 18px; margin: 15px 0;">図形探しの正答率：${searchAccuracy}％</p>
              <p style="font-size: 18px; margin: 15px 0;">図形探しのスピード：平均${avgSearchTimeSeconds}秒</p>
              ${memoryAccuracyText}
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">実験の終了プロセス</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>下の「終了する」ボタンを押すと実験データの送信が行われます。</li>
                <li>データの送信中は、画面に英語が表示されます。送信が終わると真っ白な画面になります。</li>
                <li>真っ白な画面になったら実験終了です。画面を閉じて構いません。</li>
                <li>ご協力ありがとうございました！</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">終了する</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #d1ecf1; border-radius: 8px;">
              <p style="font-size: 14px; color: #0c5460; margin: 0;">
                <strong>📊 サンプル2:</strong> 異なるパフォーマンス結果での表示例（正答率92％、平均時間1.87秒、記憶正答率83％）
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Version without memory task (for participants who didn't do memory task)
    const noMemoryResultScreen = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        const searchAccuracy = 89;
        const avgSearchTimeSeconds = 2.15;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">実験は終了です。お疲れ様でした！</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">実験結果</h2>
              <p style="font-size: 18px; margin: 15px 0;">図形探しの正答率：${searchAccuracy}％</p>
              <p style="font-size: 18px; margin: 15px 0;">図形探しのスピード：平均${avgSearchTimeSeconds}秒</p>
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">実験の終了プロセス</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>下の「終了する」ボタンを押すと実験データの送信が行われます。</li>
                <li>データの送信中は、画面に英語が表示されます。送信が終わると真っ白な画面になります。</li>
                <li>真っ白な画面になったら実験終了です。画面を閉じて構いません。</li>
                <li>ご協力ありがとうございました！</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">終了する</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #f8d7da; border-radius: 8px;">
              <p style="font-size: 14px; color: #721c24; margin: 0;">
                <strong>📝 サンプル3:</strong> 記憶課題が含まれていない条件での表示例
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Menu to choose which version to preview
    const previewMenu = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div style="max-width: 600px; margin: 0 auto; padding: 40px 20px; text-align: center;">
          <h1>リザルト画面プレビュー</h1>
          <p style="font-size: 18px; margin: 30px 0;">以下から表示したいサンプルを選択してください：</p>
          
          <div style="display: flex; flex-direction: column; gap: 15px; align-items: center;">
            <button id="sample1-btn" style="padding: 15px 30px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              サンプル1: 標準的な結果<br>
              <small>(正答率85％、平均2.34秒、記憶75％)</small>
            </button>
            
            <button id="sample2-btn" style="padding: 15px 30px; font-size: 16px; background-color: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              サンプル2: 高パフォーマンス<br>
              <small>(正答率92％、平均1.87秒、記憶83％)</small>
            </button>
            
            <button id="sample3-btn" style="padding: 15px 30px; font-size: 16px; background-color: #ffc107; color: #212529; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              サンプル3: 記憶課題なし<br>
              <small>(正答率89％、平均2.15秒)</small>
            </button>
          </div>
        </div>
      `,
      choices: "NO_KEYS",
      on_load: function() {
        document.getElementById('sample1-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample1' });
        });
        document.getElementById('sample2-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample2' });
        });
        document.getElementById('sample3-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample3' });
        });
      }
    };

    // Conditional timelines based on choice
    const conditionalSample1 = {
      timeline: [resultScreenPreview],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample1';
      }
    };

    const conditionalSample2 = {
      timeline: [alternativeResultScreen],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample2';
      }
    };

    const conditionalSample3 = {
      timeline: [noMemoryResultScreen],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample3';
      }
    };

    // Timeline
    const timeline = [
      previewMenu,
      conditionalSample1,
      conditionalSample2,
      conditionalSample3
    ];

    // Run the preview
    jsPsych.run(timeline);
  </script>
</body>
</html>