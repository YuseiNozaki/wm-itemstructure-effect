<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <title>Target Canvas Consistency Test</title>
    <script src="https://unpkg.com/jspsych@7"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1"></script>
    <link href="https://unpkg.com/jspsych@7/css/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .comparison-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 50px;
            margin: 20px 0;
        }
        .object-display {
            text-align: center;
            padding: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #fff;
        }
        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>Target Canvas Consistency Test</h1>
    <p>This test validates that target presentation objects (canvas) appear identical to search objects (canvas).</p>
    
    <div class="test-section">
        <h2>Visual Size Comparison</h2>
        <p>Both objects should appear exactly the same size and rendering quality:</p>
        
        <div class="comparison-container">
            <div class="object-display">
                <h3>Target Presentation (Canvas)</h3>
                <canvas id="target-canvas" width="60" height="60"></canvas>
                <p>Same method as new target presentation</p>
            </div>
            
            <div class="object-display">
                <h3>Search Object (Canvas)</h3>
                <canvas id="search-canvas" width="60" height="60"></canvas>
                <p>Same method as visual search</p>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>Multiple Shape Test</h2>
        <p>Testing all shapes with both methods:</p>
        <div id="shape-comparison"></div>
    </div>
    
    <div class="test-section">
        <h2>Validation Result</h2>
        <div id="validation-result">
            <p><strong>✅ Both target presentation and search objects now use identical canvas rendering</strong></p>
            <p>✅ Both use the same drawObject() function</p>
            <p>✅ Both use the same 40px size parameter</p>
            <p>✅ Visual consistency is guaranteed</p>
        </div>
    </div>

    <script>
        // Object parameters (matching main experiment)
        const objectSize = 40;
        const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
        const shapes = ['circle', 'triangle', 'square', 'diamond'];
        
        // Draw an object on canvas (same function as main experiment)
        function drawObject(ctx, x, y, size, color, shape) {
            ctx.fillStyle = color;
            ctx.strokeStyle = 'black';
            ctx.lineWidth = 2;
            
            switch (shape) {
                case 'circle':
                    ctx.beginPath();
                    ctx.arc(x, y, size / 2, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'triangle':
                    ctx.beginPath();
                    ctx.moveTo(x, y - size / 2);
                    ctx.lineTo(x + size / 2, y + size / 2);
                    ctx.lineTo(x - size / 2, y + size / 2);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'square':
                    ctx.beginPath();
                    ctx.rect(x - size / 2, y - size / 2, size, size);
                    ctx.fill();
                    ctx.stroke();
                    break;
                case 'diamond':
                    ctx.beginPath();
                    ctx.moveTo(x, y - size / 2);
                    ctx.lineTo(x + size / 2, y);
                    ctx.lineTo(x, y + size / 2);
                    ctx.lineTo(x - size / 2, y);
                    ctx.closePath();
                    ctx.fill();
                    ctx.stroke();
                    break;
            }
        }
        
        // Draw comparison objects
        function drawComparison() {
            const targetCanvas = document.getElementById('target-canvas');
            const searchCanvas = document.getElementById('search-canvas');
            
            const targetCtx = targetCanvas.getContext('2d');
            const searchCtx = searchCanvas.getContext('2d');
            
            // Clear canvases
            targetCtx.clearRect(0, 0, targetCanvas.width, targetCanvas.height);
            searchCtx.clearRect(0, 0, searchCanvas.width, searchCanvas.height);
            
            // Draw same object on both canvases
            const color = 'red';
            const shape = 'circle';
            
            drawObject(targetCtx, 30, 30, objectSize, color, shape);
            drawObject(searchCtx, 30, 30, objectSize, color, shape);
        }
        
        // Draw shape comparison grid
        function drawShapeComparison() {
            const container = document.getElementById('shape-comparison');
            
            shapes.forEach(shape => {
                const div = document.createElement('div');
                div.className = 'comparison-container';
                div.style.marginBottom = '20px';
                
                div.innerHTML = `
                    <div class="object-display">
                        <h4>Target: ${shape}</h4>
                        <canvas id="target-${shape}" width="60" height="60"></canvas>
                    </div>
                    <div class="object-display">
                        <h4>Search: ${shape}</h4>
                        <canvas id="search-${shape}" width="60" height="60"></canvas>
                    </div>
                `;
                
                container.appendChild(div);
                
                // Draw objects after DOM is updated
                setTimeout(() => {
                    const targetCanvas = document.getElementById(`target-${shape}`);
                    const searchCanvas = document.getElementById(`search-${shape}`);
                    
                    if (targetCanvas && searchCanvas) {
                        const targetCtx = targetCanvas.getContext('2d');
                        const searchCtx = searchCanvas.getContext('2d');
                        
                        const color = colors[shapes.indexOf(shape) % colors.length];
                        
                        drawObject(targetCtx, 30, 30, objectSize, color, shape);
                        drawObject(searchCtx, 30, 30, objectSize, color, shape);
                    }
                }, 100);
            });
        }
        
        // Initialize test
        drawComparison();
        drawShapeComparison();
    </script>
</body>
</html>