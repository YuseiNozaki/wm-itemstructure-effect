<!DOCTYPE html>
<html>
<head>
    <title>Simple Focus Test</title>
    <script src="https://unpkg.com/jspsych@6.3.1/jspsych.js"></script>
    <script src="https://unpkg.com/jspsych@6.3.1/plugins/jspsych-html-keyboard-response.js"></script>
    <link href="https://unpkg.com/jspsych@6.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
    <style>
        #jspsych-target {
            outline: none;
        }
    </style>
</head>
<body>
    <div id="jspsych-target" tabindex="0"></div>
    
    <script>
        // Focus management functions
        function ensureFocus() {
            const targetElement = document.getElementById('jspsych-target');
            if (targetElement && document.activeElement !== targetElement) {
                console.log('Restoring focus to target element');
                targetElement.focus();
            }
        }

        // Global click handler
        function handleGlobalClick(e) {
            console.log('Click detected on:', e.target.tagName);
            if (!e.target.closest('input, select, textarea, button')) {
                console.log('Click on empty area, restoring focus');
                ensureFocus();
            }
        }

        // Early setup
        document.addEventListener('DOMContentLoaded', function() {
            const targetElement = document.getElementById('jspsych-target');
            if (targetElement) {
                targetElement.focus();
                document.addEventListener('click', handleGlobalClick);
            }
        });

        // Monitor keyboard events
        document.addEventListener('keydown', function(e) {
            console.log('Key pressed:', e.key, 'Active element:', document.activeElement.tagName);
        });

        // Simple jsPsych experiment
        const timeline = [
            {
                type: 'html-keyboard-response',
                stimulus: '<h1>Test</h1><p>Press Enter to continue. Try clicking empty areas first.</p>',
                choices: ['Enter'],
                on_load: function() {
                    setTimeout(ensureFocus, 100);
                }
            },
            {
                type: 'html-keyboard-response',
                stimulus: '<h1>Success!</h1><p>Enter key is working. Press Enter to finish.</p>',
                choices: ['Enter']
            }
        ];

        jsPsych.init({
            display_element: 'jspsych-target',
            timeline: timeline,
            on_finish: function() {
                jsPsych.data.displayData();
            },
            on_load: function() {
                document.addEventListener('click', handleGlobalClick);
                setTimeout(ensureFocus, 100);
            }
        });
    </script>
</body>
</html>