<!DOCTYPE html>
<html>
<head>
  <title>Result Screen Preview - ãƒªã‚¶ãƒ«ãƒˆç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/jspsych@7"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1"></script>
  <link href="https://unpkg.com/jspsych@7/css/jspsych.css" rel="stylesheet" type="text/css" />
  <link href="../styles.css" rel="stylesheet" type="text/css" />
  <style>
    body {
      font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <div id="jspsych-target"></div>
  
  <script>
    // Initialize jsPsych v7 instance
    const jsPsych = initJsPsych({
      display_element: 'jspsych-target',
      on_finish: function() {
        alert('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†ï¼å®Ÿéš›ã®å®Ÿé¨“ã§ã¯ã€ã“ã®å¾Œãƒ‡ãƒ¼ã‚¿ãŒé€ä¿¡ã•ã‚Œã¾ã™ã€‚');
      }
    });

    // Mock data to simulate experiment results
    const mockSearchData = {
      count: () => 120, // Total trials
      filter: (criteria) => ({
        count: () => criteria.correct ? 102 : 120, // 85% accuracy
        select: (field) => ({
          values: field === 'rt' ? 
            Array.from({length: 120}, () => Math.random() * 2000 + 1500) : // 1.5-3.5 second range
            Array.from({length: 120}, () => Math.random() > 0.15) // 85% correct
        })
      }),
      select: (field) => ({
        values: field === 'rt' ? 
          Array.from({length: 120}, () => Math.random() * 2000 + 1500) : // Random response times
          (field === 'memory_correct' ? 
            Array.from({length: 60}, () => Math.random() > 0.25) : // 75% memory accuracy
            [])
      })
    };

    // Enhanced result screen preview with sample data
    const resultScreenPreview = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        // Simulate calculation with mock data
        const searchAccuracy = 85; // Mock 85% accuracy
        const avgSearchTimeSeconds = 2.34; // Mock average time
        const memoryAccuracy = 75; // Mock 75% memory accuracy
        
        const memoryAccuracyText = `<p style="font-size: 18px; margin: 15px 0;">ãƒ‘ãƒãƒ«è¨˜æ†¶ã®æ­£ç­”ç‡ï¼š${memoryAccuracy}ï¼…</p>`;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">å®Ÿé¨“ã¯çµ‚äº†ã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">å®Ÿé¨“çµæœ</h2>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®æ­£ç­”ç‡ï¼š${searchAccuracy}ï¼…</p>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼šå¹³å‡${avgSearchTimeSeconds}ç§’</p>
              ${memoryAccuracyText}
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">å®Ÿé¨“ã®çµ‚äº†ãƒ—ãƒ­ã‚»ã‚¹</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>ä¸‹ã®ã€Œçµ‚äº†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ä¸­ã¯ã€ç”»é¢ã«è‹±èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚é€ä¿¡ãŒçµ‚ã‚ã‚‹ã¨çœŸã£ç™½ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚</li>
                <li>çœŸã£ç™½ãªç”»é¢ã«ãªã£ãŸã‚‰å®Ÿé¨“çµ‚äº†ã§ã™ã€‚ç”»é¢ã‚’é–‰ã˜ã¦æ§‹ã„ã¾ã›ã‚“ã€‚</li>
                <li>ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">çµ‚äº†ã™ã‚‹</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #fff3cd; border-radius: 8px;">
              <p style="font-size: 14px; color: #856404; margin: 0;">
                <strong>ğŸ“ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒãƒ¼ãƒˆ:</strong> ã“ã‚Œã¯çµæœç”»é¢ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã™ã€‚å®Ÿéš›ã®å®Ÿé¨“ã§ã¯ã€å‚åŠ è€…ã®å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Alternative version with different sample data
    const alternativeResultScreen = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        // Different sample data for comparison
        const searchAccuracy = 92; // Higher accuracy sample
        const avgSearchTimeSeconds = 1.87; // Faster time sample
        const memoryAccuracy = 83; // Different memory accuracy
        
        const memoryAccuracyText = `<p style="font-size: 18px; margin: 15px 0;">ãƒ‘ãƒãƒ«è¨˜æ†¶ã®æ­£ç­”ç‡ï¼š${memoryAccuracy}ï¼…</p>`;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">å®Ÿé¨“ã¯çµ‚äº†ã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">å®Ÿé¨“çµæœ</h2>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®æ­£ç­”ç‡ï¼š${searchAccuracy}ï¼…</p>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼šå¹³å‡${avgSearchTimeSeconds}ç§’</p>
              ${memoryAccuracyText}
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">å®Ÿé¨“ã®çµ‚äº†ãƒ—ãƒ­ã‚»ã‚¹</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>ä¸‹ã®ã€Œçµ‚äº†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ä¸­ã¯ã€ç”»é¢ã«è‹±èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚é€ä¿¡ãŒçµ‚ã‚ã‚‹ã¨çœŸã£ç™½ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚</li>
                <li>çœŸã£ç™½ãªç”»é¢ã«ãªã£ãŸã‚‰å®Ÿé¨“çµ‚äº†ã§ã™ã€‚ç”»é¢ã‚’é–‰ã˜ã¦æ§‹ã„ã¾ã›ã‚“ã€‚</li>
                <li>ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">çµ‚äº†ã™ã‚‹</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #d1ecf1; border-radius: 8px;">
              <p style="font-size: 14px; color: #0c5460; margin: 0;">
                <strong>ğŸ“Š ã‚µãƒ³ãƒ—ãƒ«2:</strong> ç•°ãªã‚‹ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµæœã§ã®è¡¨ç¤ºä¾‹ï¼ˆæ­£ç­”ç‡92ï¼…ã€å¹³å‡æ™‚é–“1.87ç§’ã€è¨˜æ†¶æ­£ç­”ç‡83ï¼…ï¼‰
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Version without memory task (for participants who didn't do memory task)
    const noMemoryResultScreen = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        const searchAccuracy = 89;
        const avgSearchTimeSeconds = 2.15;
        
        return `
          <div style="max-width: 700px; margin: 0 auto; padding: 40px 20px; text-align: center; line-height: 1.6;">
            <h1 style="color: #2c3e50; margin-bottom: 30px;">å®Ÿé¨“ã¯çµ‚äº†ã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h1>
            
            <div style="background-color: #f8f9fa; padding: 30px; border-radius: 10px; margin: 30px 0;">
              <h2 style="color: #495057; margin-bottom: 20px;">å®Ÿé¨“çµæœ</h2>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®æ­£ç­”ç‡ï¼š${searchAccuracy}ï¼…</p>
              <p style="font-size: 18px; margin: 15px 0;">å›³å½¢æ¢ã—ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ï¼šå¹³å‡${avgSearchTimeSeconds}ç§’</p>
            </div>
            
            <div style="background-color: #e7f3ff; padding: 25px; border-radius: 10px; margin: 30px 0; text-align: left;">
              <h3 style="color: #0056b3; margin-bottom: 15px; text-align: center;">å®Ÿé¨“ã®çµ‚äº†ãƒ—ãƒ­ã‚»ã‚¹</h3>
              <ol style="font-size: 16px; line-height: 1.8; padding-left: 20px;">
                <li>ä¸‹ã®ã€Œçµ‚äº†ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨å®Ÿé¨“ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ãŒè¡Œã‚ã‚Œã¾ã™ã€‚</li>
                <li>ãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡ä¸­ã¯ã€ç”»é¢ã«è‹±èªãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚é€ä¿¡ãŒçµ‚ã‚ã‚‹ã¨çœŸã£ç™½ãªç”»é¢ã«ãªã‚Šã¾ã™ã€‚</li>
                <li>çœŸã£ç™½ãªç”»é¢ã«ãªã£ãŸã‚‰å®Ÿé¨“çµ‚äº†ã§ã™ã€‚ç”»é¢ã‚’é–‰ã˜ã¦æ§‹ã„ã¾ã›ã‚“ã€‚</li>
                <li>ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</li>
              </ol>
            </div>
            
            <div style="margin: 30px 0;">
              <button id="end-screen-next-btn" style="padding: 15px 30px; font-size: 18px; background-color: #dc3545; color: white; border: none; border-radius: 8px; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">çµ‚äº†ã™ã‚‹</button>
            </div>
            
            <div style="margin-top: 40px; padding: 20px; background-color: #f8d7da; border-radius: 8px;">
              <p style="font-size: 14px; color: #721c24; margin: 0;">
                <strong>ğŸ“ ã‚µãƒ³ãƒ—ãƒ«3:</strong> è¨˜æ†¶èª²é¡ŒãŒå«ã¾ã‚Œã¦ã„ãªã„æ¡ä»¶ã§ã®è¡¨ç¤ºä¾‹
              </p>
            </div>
          </div>
        `;
      },
      choices: "NO_KEYS",
      on_load: function() {
        // Add click event listener to the End button
        const nextBtn = document.getElementById('end-screen-next-btn');
        nextBtn.addEventListener('click', function() {
          jsPsych.finishTrial();
        });
      }
    };

    // Menu to choose which version to preview
    const previewMenu = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: `
        <div style="max-width: 600px; margin: 0 auto; padding: 40px 20px; text-align: center;">
          <h1>ãƒªã‚¶ãƒ«ãƒˆç”»é¢ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h1>
          <p style="font-size: 18px; margin: 30px 0;">ä»¥ä¸‹ã‹ã‚‰è¡¨ç¤ºã—ãŸã„ã‚µãƒ³ãƒ—ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼š</p>
          
          <div style="display: flex; flex-direction: column; gap: 15px; align-items: center;">
            <button id="sample1-btn" style="padding: 15px 30px; font-size: 16px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              ã‚µãƒ³ãƒ—ãƒ«1: æ¨™æº–çš„ãªçµæœ<br>
              <small>(æ­£ç­”ç‡85ï¼…ã€å¹³å‡2.34ç§’ã€è¨˜æ†¶75ï¼…)</small>
            </button>
            
            <button id="sample2-btn" style="padding: 15px 30px; font-size: 16px; background-color: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              ã‚µãƒ³ãƒ—ãƒ«2: é«˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹<br>
              <small>(æ­£ç­”ç‡92ï¼…ã€å¹³å‡1.87ç§’ã€è¨˜æ†¶83ï¼…)</small>
            </button>
            
            <button id="sample3-btn" style="padding: 15px 30px; font-size: 16px; background-color: #ffc107; color: #212529; border: none; border-radius: 8px; cursor: pointer; min-width: 300px;">
              ã‚µãƒ³ãƒ—ãƒ«3: è¨˜æ†¶èª²é¡Œãªã—<br>
              <small>(æ­£ç­”ç‡89ï¼…ã€å¹³å‡2.15ç§’)</small>
            </button>
          </div>
        </div>
      `,
      choices: "NO_KEYS",
      on_load: function() {
        document.getElementById('sample1-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample1' });
        });
        document.getElementById('sample2-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample2' });
        });
        document.getElementById('sample3-btn').addEventListener('click', function() {
          jsPsych.finishTrial({ choice: 'sample3' });
        });
      }
    };

    // Conditional timelines based on choice
    const conditionalSample1 = {
      timeline: [resultScreenPreview],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample1';
      }
    };

    const conditionalSample2 = {
      timeline: [alternativeResultScreen],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample2';
      }
    };

    const conditionalSample3 = {
      timeline: [noMemoryResultScreen],
      conditional_function: function() {
        const lastTrialData = jsPsych.data.getLastTrialData().values()[0];
        return lastTrialData && lastTrialData.choice === 'sample3';
      }
    };

    // Timeline
    const timeline = [
      previewMenu,
      conditionalSample1,
      conditionalSample2,
      conditionalSample3
    ];

    // Run the preview
    jsPsych.run(timeline);
  </script>
</body>
</html>