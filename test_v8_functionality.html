<!DOCTYPE html>
<html>
<head>
  <title>Test Updated jsPsych v8</title>
  <script src="https://unpkg.com/jspsych@8.2.1/dist/jspsych.js"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0/dist/index.browser.min.js"></script>
  <link href="https://unpkg.com/jspsych@8.2.1/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<body>
  <div id="jspsych-target"></div>
  <script>
    // Test the same pattern as in the main index.html
    const jsPsych = initJsPsych({
      display_element: 'jspsych-target',
      on_finish: function() {
        console.log('Test completed successfully');
        jsPsych.data.displayData();
      }
    });

    // Test timeline variables (used extensively in main file)
    const testTrial = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        const condition = jsPsych.timelineVariable('condition') || 'default';
        return `<p>Testing timeline variable: ${condition}</p><p>Press any key to continue.</p>`;
      }
    };

    // Test randomization functions
    const randomizationTest = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        const colors = ['red', 'blue', 'green'];
        const randomColor = jsPsych.randomization.sampleWithoutReplacement(colors, 1)[0];
        return `<p>Random color: ${randomColor}</p><p>Press SPACE to continue.</p>`;
      },
      choices: [' ']
    };

    // Test data access
    const dataTest = {
      type: jsPsychHtmlKeyboardResponse,
      stimulus: function() {
        const data = jsPsych.data.get().last(1);
        return `<p>Data collected successfully</p><p>Press any key to end.</p>`;
      },
      choices: 'NO_KEYS',
      trial_duration: 2000
    };

    // Test factorial design
    const factorialTimeline = {
      timeline: [testTrial],
      timeline_variables: jsPsych.randomization.factorial({
        condition: ['A', 'B']
      }),
      randomize_order: true
    };

    const timeline = [
      randomizationTest,
      factorialTimeline,
      dataTest
    ];

    jsPsych.run(timeline);
  </script>
</body>
</html>